  .inesmir 1 ;mirroring
  .inesmap 0 ;mapper number (no mapper)
  .ineschr 1 ;number of 8kb banks
  .inesprg 2 ;number of 16kb banks

  .bank 3
  .org $FFFA ;stores location interupts (vector table)

  .dw NMI ;Non Maskable interupt
          ;Can be masked at address $2000 bit 7 is clear

  .dw start ;where to start the game aka reset interrupt
  .dw 0 ;regular interupt not important

  .bank 0
;****Zero-Page*************************
  .org $0000
gameactive: .db 0
vidlow: .db 0
vidhigh: .db 0

;****RAM********************************
  .org $0200 
sprite:

  .org $0300 
playerx: .db 0
playery: .db 0
ticks: .db 0
nmis: .db 0
;****GAME******************************  
  .org $8000

;**********VBLANK-NMI*******************

NMI:
  inc nmis
  rti

;**********Start/RESET******************

start:
  cld ;clear decimal mode
  sei ;disable irq maskable interupt
  sec ;set carry
  lda #$00 ;load a with 0 to zero out memory
  tax ;make x register 0 as well
  sta $2000 ;disables nmi
  sta $2001 ;disables rendering
  dex
  txs ;init the stack pointer $01FF
  bit $2002 ;acknowledge PPU STATUS
  bit $4015 ;acknowledge DMC
 

  ;init apu
  lda #%01000000 ;disable apu frame IRQ
  sta $4017
  lda #%00001111 ;disable DMC playback and init other channels
  sta $4015
  
  ldy #$13
init_apu_loop:
  lda regs, y
  sta 4000, y
  dey
  bpl init_apu_loop
  

vblank_wait1:
  bit $2002 ;wait on ppu status register
  bpl vblank_wait1

;clear ppu oam
  ldx #0
  lda #$FF
clear_oam_loop:
  sta $2003,x
  inx
  inx
  inx
  inx
  bne clear_oam_loop





vblank_wait2:
  bit $2002
  bpl vblank_wait2



;set palettes
  lda $2002 ;reset high low latch of bit 7 vblank bit
  lda #$3F ;set ppu address to start at $3F00
  sta $2006
  lda #$00
  sta $2006


  ldx #$00
palette_loop:
  lda palette, x
  sta $2007
  inx
  cpx #32
  bcc palette_loop


;ppu clear
  ldx #$20
  lda #$00
  ldy #$AA
 
  stx $2006
  ldx #$00
  stx $2006
  
  ldx #240
ppu_clear_nametable:
  sta $2007
  sta $2007
  sta $2007
  sta $2007
  dex
  bne ppu_clear_nametable

  ldx #64

ppu_clear_attr_table:
  sty $2007
  dex
  bne ppu_clear_attr_table
  
;draw something
  lda #$23
  sta $2006
  lda #$00
  sta $2006
  ldx #32
  lda #18
draw_loop:
  sta $2007
  dex
  bne draw_loop
  ldx #$80
  lda #19
draw_rest_loop:
  sta $2007
  dex
  bne draw_rest_loop
   

;sprites
  lda #$B7 ;put sprite on ground
  sta sprite
  lda #$00 ;put sprite to the left
  sta sprite + 3
  
  lda #$01 ;load tile number
  sta sprite + 1
  lda #$00 ;load color palette
  sta sprite + 2

;enable nmi and use pattern table 0
  lda #%10000000
  sta $2000

;init ticks
  lda #$00
  sta ticks


end_loop:
  lda nmis
vblank_wait3:
  cmp nmis
  beq vblank_wait3

;sprite animation frame handling  
  inc ticks
  inc sprite + 3
  lda #09
  cmp ticks
  bne skip_frame_change
  lda #0
  sta ticks
  inc sprite + 1
  lda sprite + 1
  cmp #4
  bne skip_frame_change
  lda #1
  sta sprite + 1



skip_frame_change:



;sprite dma
  lda #$00
  sta $2003
  lda #$02
  sta $4014
  
  ldx #0
  ldy #0
  lda #%10000000
  stx $2005
  sty $2005
  sta $2000
  lda #%00011110
  sta $2001

  jmp end_loop

;*********Functions*********************



;***Data********************************
  .bank 3
  .org $E000
palette: .db $0F,$17,$28,$39,  $0F,$17,$28,$39,  $0F,$17,$28,$39,  $0F,$17,$28,$39
         .db $0F,$37,$07,$0A,  $0F,$17,$28,$39,  $0F,$17,$28,$39,  $0F,$17,$28,$39
regs:
        .db $30,$08,$00,$00
        .db $30,$08,$00,$00
        .db $80,$00,$00,$00
        .db $30,$00,$00,$00
        .db $00,$00,$00,$00

periodTableLo:
  .db $f1,$7f,$13,$ad,$4d,$f3,$9d,$4c,$00,$b8,$74,$34
  .db $f8,$bf,$89,$56,$26,$f9,$ce,$a6,$80,$5c,$3a,$1a
  .db $fb,$df,$c4,$ab,$93,$7c,$67,$52,$3f,$2d,$1c,$0c
  .db $fd,$ef,$e1,$d5,$c9,$bd,$b3,$a9,$9f,$96,$8e,$86
  .db $7e,$77,$70,$6a,$64,$5e,$59,$54,$4f,$4b,$46,$42
  .db $3f,$3b,$38,$34,$31,$2f,$2c,$29,$27,$25,$23,$21
  .db $1f,$1d,$1b,$1a,$18,$17,$15,$14

periodTableHi:
  .db $07,$07,$07,$06,$06,$05,$05,$05,$05,$04,$04,$04
  .db $03,$03,$03,$03,$03,$02,$02,$02,$02,$02,$02,$02
  .db $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01
  .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00


;**********CHR**************************
  .bank 4
  .org $0000
  .incbin "game.chr"



